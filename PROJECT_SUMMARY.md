
# ملخص تقدم مشروع RestoSwift POS

## نظرة عامة
يهدف مشروع RestoSwift POS إلى تطوير نظام نقاط بيع (POS) حديث وسهل الاستخدام للمطاعم، مع التركيز على اللغة العربية والعملة السورية (ل.س). تم بناء المشروع باستخدام Next.js (App Router)، React، TypeScript، و Tailwind CSS، مع الاستعانة بمكونات ShadCN UI.

## المراحل والوظائف المنجزة:

1.  **الإعداد الأولي للمشروع:**
    *   إنشاء مشروع Next.js جديد باستخدام أحدث إصدار (يدعم App Router).
    *   تثبيت وإعداد Tailwind CSS لتصميم الواجهات.
    *   تضمين TypeScript لضمان جودة الكود وسلامة الأنواع.
    *   إعداد ESLint لتوحيد نمط الكود.

2.  **إدارة البيانات الأساسية (قاعدة بيانات محلية):**
    *   اعتماد `Lowdb` كحل قاعدة بيانات محلية بسيطة، باستخدام ملف `db.json` في جذر المشروع لتخزين:
        *   `menuItems`: قائمة أصناف الطعام (الاسم، السعر، الفئة، حالة التوفر، معرف فريد).
        *   `orders`: قائمة الطلبات المكتملة (معرف فريد تسلسلي رقمي، الطابع الزمني، الأصناف المطلوبة وكمياتها، المبلغ الإجمالي، الحالة، طريقة الدفع، معرف المستخدم الاختياري).
        *   `lastOrderId`: لتتبع آخر رقم فاتورة تم استخدامه.
        *   `users`: قائمة المستخدمين (اسم المستخدم، كلمة المرور المجزأة - حاليًا نص عادي، الدور).
        *   `appSettings`: إعدادات التطبيق (مثل اسم المطعم).
        *   `expenses`: قائمة المصاريف (المعرف، الوصف، المبلغ، التاريخ، الفئة الاختيارية).
    *   إنشاء `src/lib/db.ts` لتهيئة Lowdb وتحديد هياكل البيانات (interfaces).
    *   توفير بيانات أولية (افتراضية) في `db.json` لبدء تشغيل التطبيق، بما في ذلك مستخدم إداري افتراضي.

3.  **وظائف الخادم (Server Actions):**
    *   إنشاء `src/app/actions.ts` لتضمين منطق التعامل مع قاعدة البيانات من جانب الخادم بشكل آمن:
        *   `getMenuItems(onlyAvailable: boolean)`: لجلب قائمة أصناف الطعام.
        *   `addMenuItemAction(...)`: لإضافة صنف جديد.
        *   `updateMenuItemAction(...)`: لتحديث صنف موجود.
        *   `toggleMenuItemAvailabilityAction(id: string)`: لتبديل حالة توفر صنف.
        *   `deleteMenuItemAction(id: string)`: لحذف صنف (مع تأكيد).
        *   `completeOrderAndPrint(orderItems: OrderItem[], userId?: string)`: لإتمام الطلب وحفظه.
        *   `getDailySalesReport()`: لجلب تقرير المبيعات اليومي.
        *   `getItemSalesCountReport(startDate?: number, endDate?: number)`: لجلب تقرير كميات الأصناف المباعة ضمن نطاق تاريخي.
        *   `loginAction(username, password)`: للتحقق من بيانات تسجيل الدخول.
        *   `getRestaurantNameAction()`: لجلب اسم المطعم.
        *   `updateRestaurantNameAction(newName)`: لتحديث اسم المطعم.
        *   `addExpenseAction(...)`: لإضافة مصروف جديد.
        *   `getExpensesAction(startDate?: number, endDate?: number)`: لجلب قائمة المصاريف.
        *   `deleteExpenseAction(id: string)`: لحذف مصروف.

4.  **الواجهة الرئيسية لنقاط البيع (POS - `src/app/page.tsx`):**
    *   تصميم مقسم لعرض أصناف الطعام والفاتورة الحالية.
    *   إضافة الأصناف إلى الفاتورة بنقرة واحدة على بطاقتها (تم إزالة زر "إضافة").
    *   منع تحديد النص عند النقر المتكرر على بطاقات الأصناف.
    *   إتمام الطلب والطباعة مباشرة دون مربع حوار تأكيدي.
    *   تحسين تصميم الفاتورة المطبوعة لتكون أكثر احترافية.
    *   جعل أرقام الفواتير تسلسلية رقمية.

5.  **واجهة إدارة القائمة (`src/app/admin/menu/page.tsx`):**
    *   استخدام `MenuContext` لجلب وعرض قائمة الطعام من `db.json` والتفاعل مع Server Actions.
    *   نموذج لإضافة وتعديل أصناف الطعام.
    *   إمكانية تبديل حالة توفر الصنف.
    *   إمكانية حذف صنف مع مربع حوار تأكيدي.
    *   عرض مؤشرات التحميل ورسائل التنبيه (toasts).

6.  **واجهة التقارير (`src/app/admin/reports/page.tsx`):**
    *   التقرير اليومي (إجمالي المبيعات وعدد الفواتير) يتم جلبه "عند الطلب" بعد الضغط على زر.
    *   تقرير كميات الأصناف المباعة يمكن تصفيته حسب نطاق تاريخي محدد باستخدام `DatePicker`.
    *   عرض حالات التحميل والأخطاء.

7.  **نظام المصادقة الأساسي:**
    *   إنشاء `AuthContext` لإدارة حالة تسجيل دخول المستخدم (باستخدام `localStorage` مبدئيًا).
    *   صفحة تسجيل دخول (`/login`) للتحقق من المستخدمين المسجلين في `db.json` (باسم مستخدم وكلمة مرور افتراضيين).
    *   حماية مسارات الإدارة (`/admin/*`) بحيث لا يمكن الوصول إليها إلا من قبل المستخدمين ذوي دور "admin".
    *   تحديث الترويسة لعرض حالة تسجيل الدخول، اسم المستخدم، روابط الإدارة (فقط للمدير)، وزر تسجيل الخروج.

8.  **صفحة الإعدادات (مبدئية - `/admin/settings/page.tsx`):**
    *   صفحة محمية للمدير. (سيتم تطوير محتواها لاحقًا للسماح بتغيير اسم المطعم وصلاحيات المستخدمين).

9.  **إدارة المصاريف (`/src/app/admin/expenses/page.tsx`):**
    *   صفحة جديدة ضمن لوحة التحكم لإدارة المصاريف.
    *   نموذج لإضافة مصروف جديد (الوصف، المبلغ، الفئة الاختيارية).
    *   عرض المصاريف المسجلة في جدول مع إمكانية الحذف (مع تأكيد).
    *   إمكانية تصفية المصاريف المعروضة حسب نطاق تاريخي.
    *   عرض مؤشرات التحميل ورسائل التنبيه (toasts).

10. **التصميم والمظهر:**
    *   استخدام مكونات ShadCN UI بشكل واسع.
    *   تخصيص ألوان الواجهة عبر `src/app/globals.css`.
    *   دعم كامل للغة العربية والتخطيط من اليمين إلى اليسار (RTL).
    *   خيار تبديل السمة (فاتح/داكن/النظام).

## الوضع الحالي:
النظام يحتوي على وظائف نقاط بيع متكاملة، إدارة قائمة طعام (إضافة، تعديل، حذف، تبديل الإتاحة)، تقارير مبيعات أساسية مع تصفية تاريخية، نظام تسجيل دخول أساسي لحماية لوحة التحكم، وإدارة المصاريف. اسم المطعم المعروض في الترويسة يأتي الآن من `db.json` عبر `AuthContext`.

## الخطوات المستقبلية المحتملة:
*   تطوير صفحة الإعدادات للسماح بتغيير اسم المطعم من قبل المدير.
*   إضافة ميزة "فاتورة مرتجعة".
*   تحسين نظام التقارير (مثل تقارير مخصصة للموظفين بعد ربط الطلبات بهم).
*   إدارة المستخدمين والصلاحيات (لتمكين موظفي الكاشير من تسجيل الدخول وتنفيذ عمليات البيع فقط).
*   إضافة ميزات إدارة المخزون (بشكل مبسط).
*   الانتقال إلى قاعدة بيانات أكثر قوة في مرحلة الإنتاج.
*   إمكانية إضافة صور للأصناف في واجهة الإدارة وعرضها اختياريًا.
*   تحسين أمان كلمات المرور (استخدام تجزئة حقيقية مثل bcrypt).
